---
title: "CovidPlots"
output: 
    github_document:
        toc: true
        toc_depth: 4
date: '`r format(Sys.time(), "%d %B %Y %I:%M %p %Z")`'
---


```{r, setup, include=FALSE}
knitr::opts_chunk$set(out.width = 4800,  fig.width = 12, fig.asp=0.62,  dev = 'svg') 
knitr::opts_chunk$set(echo = TRUE)
```

```{r, get_county_data, include=FALSE}
    source("nytimes_us_counties.r")

    selected <- getSelectedCounties(countyPopulations, ISOdate(2020,3,1, tz=""))
    subtext = "Data from NY Times via covid-19.datasettes.com"

```

## Covid in a Few Interesting Counties  

Covid case counts and death counts by county, based on daily data from NY Times via https://covid-19.datasettes.com

### Cases

```{r, selected_counties_cases, echo=FALSE, results='hide', message=FALSE,warning=FALSE}


    print(covidPlot(cases~date | county, data=selected, group=state,
                    subtitle=subtext, 
                    main="Selected Counties",
                    ylab="Cases",
                    xlab="Date"))
    
    print(covidPlot(cases~date | county, data=selected, group=state, 
                    subtitle=subtext, 
                    logY=4,
                    main="Selected Counties",
                    ylab="Cases",
                    xlab="Date"))
    
    print(covidPlot(100000*cases/county.population~date | county, data=selected, group=state, 
                    subtitle=subtext, 
                    main="Selected Counties",
                    ylab="Cases per 100,000",
                    xlab="Date"))
    
    print(covidPlot(cases~date, data=selected, group=county, 
                    subtitle=subtext, 
                    main="Selected Counties",
                    ylab="Cases",
                    xlab="Date",
                    auto.key= list(cex=0.6, columns=3), 
                    par.settings= list(superpose.symbol=list(pch=1:25)) ))
    
    print(covidPlot(100000*cases/county.population~date , data=selected, group=county,
                    subtitle=subtext, 
                    main="Selected Counties",
                    ylab="Cases per 100,000", 
                    auto.key= list(cex=0.6, columns=3),
                    par.settings= list(superpose.symbol=list(pch=1:25)) ))
    
```
        
### Deaths

```{r, selected_counties_deaths, echo=FALSE, results='hide', message=FALSE,warning=FALSE}    
    
 print(covidPlot(deaths~date | county, data=selected, group=state,
                    subtitle=subtext, 
                    main="Selected Counties",
                    ylab="Deaths",
                    xlab="Date"))
    
  print(covidPlot(deaths~date | county, data=selected, group=state, 
                    subtitle=subtext, 
                    logY=4,
                    main="Selected Counties",
                    ylab="Deaths",
                    xlab="Date"))
  
  print(covidPlot(100000*deaths/county.population~date | county, data=selected, group=state, 
                    subtitle=subtext,
                    logY = FALSE,
                    main="Selected Counties",
                    ylab="Deaths per 100,000",
                    xlab="Date"))
	  

  print(covidPlot(100000*deaths/county.population~date | county, data=selected, group=state, 
                    subtitle=subtext, 
                    main="Selected Counties",
                    ylab="Deaths per 100,000",
                    xlab="Date"))
					
									
					
					
    print(symmetricPlot(death.slope ~ date | county, data=selected, group=selected$state, 
                        subtitle = subtext, 
                        main="Selected Counties", 
                        ylab="Slope (Deaths/Day)",
                        xlab="Date"))

    print(symmetricPlot(100000*death.slope/county.population~date | county, data=selected, group=selected$state, 
                        subtitle = subtext, 
                        main="Selected Counties", 
                        ylab="Slope (Deaths/Day/100,000)",
                        xlab="Date"))
    
    

```

## Covid in Several States by County  
The following states are plotted on seperate pages:

```{r, plot_counties, echo=FALSE, results='hide', message=FALSE,warning=FALSE}
  
states_to_plot <- c("California", "New York", "Michigan", "Hawaii", "Texas", "Georgia", "Florida")
plotCountiesToMD(states_to_plot, countyPopulations)
```

```{r, plot_counties)links, echo=FALSE, results='asis'}

for (state in states_to_plot){
  cat(paste("###", state, "Counties", "\n"))
  cat(paste("[", state, " County Plots](", state, "_Counties.md)", "\n", sep=""))
  cat("\n")
}

```


## CDC All Deaths by Week
The CDC Flu View website gives weekly deaths by state going back several years. Data entry and reporting lags by many weeks, so the last month or so of deaths will be under-reported or missing.

https://gis.cdc.gov/grasp/fluview/mortality.html

```{r, cdc_all_deaths, echo=FALSE, results='hide', message=FALSE,warning=FALSE}
  source("cdc_deaths.r")
  print(p_all_deaths_recent)
  print(p_year_on_year_linear)
  print(p_year_on_year)

```





## Covid in US States 
Covid positive tests, deaths, and hospitalizations by state from covidtracking.com https://covidtracking.com

### Hospitalizations

```{r,  state_hospital, echo=FALSE, results='hide', message=FALSE,warning=FALSE}
    source("covidtracking_us_states.r")
  print (p_hosp)
  print(p_hospPer)
```

### Tests

```{r,  state_positves, echo=FALSE, results='hide', message=FALSE,warning=FALSE}
    
  print(p_positives)
  print(p_positive_fraction)
  print(p_positivesPer)
  print (p_deltaPositivesPer)
  print(p_total_tests)
  print(p_total_tests_per)
```

### Deaths

```{r,  state_deaths, echo=FALSE, results='hide', message=FALSE,warning=FALSE}
    
  print(p_deaths)
  print(p_deathsPerLinear)
  print (p_deathsPer)
  print(p_deltaDeathsPer)
    
```


## Covid in China 

Covid data from Johns Hopkins CSSE via https://covid-19.datasettes.com
```{r,  china, echo=FALSE, results='hide', message=FALSE,warning=FALSE}
    source("covid_international.r")
    print(p_china)
    print(p_china_deaths)
```

## Covid in Scandanavia 
```{r,  scandanavia, echo=FALSE, results='hide', message=FALSE,warning=FALSE}
  print(p_scandanavia)
  print(p_scandanavia_per)
  print(p_scandanavia_per_log2)
  print(p_scandanavia_deaths)
  print(p_scandanavia_deaths_per_linear)
  print(p_scandanavia_deaths_per)
  print(p_scandanavia_deaths_per_log2)
```